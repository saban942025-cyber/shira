<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#d4af37">
    <meta name="description" content="שירה קוסמטיקס - טיפולי יופי מתקדמים בהוד השרון. קביעת תורים אונליין.">
    <title>שירה קוסמטיקס</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- עיצוב יוקרתי --- */
        :root {
            --primary: #d4af37;
            --primary-light: #f3e5ab;
            --bg-body: #fcfbf9;
            --text-main: #333;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* --- אלמנטים כלליים --- */
        header {
            padding: 15px; text-align: center; background: #fff;
            position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        h1 { margin: 0; color: var(--primary); font-size: 1.4rem; font-weight: 700; }
        
        .btn-main {
            background: var(--primary); color: white; padding: 14px; width: 100%;
            border: none; border-radius: 12px; font-weight: bold; font-size: 1.1rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4); cursor: pointer;
        }
        .btn-whatsapp { background: #25D366; }
        .btn-calendar { background: #4285F4; margin-top: 10px; display: none; }

        input, textarea, select {
            width: 100%; padding: 12px; margin: 8px 0;
            border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;
            font-family: inherit;
        }

        /* --- סליידר וגלריה --- */
        .carousel-container {
            position: relative; width: 94%; height: 220px; margin: 15px auto;
            border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow);
        }
        .carousel-slide {
            position: absolute; inset: 0; opacity: 0; transition: opacity 1s;
            background-size: cover; background-position: center;
        }
        .carousel-slide.active { opacity: 1; }
        .hero-overlay {
            position: absolute; bottom: 0; width: 100%; padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
            display: flex; justify-content: center;
        }
        .hero-btn {
            background: var(--primary); color: white; padding: 8px 20px;
            border-radius: 20px; text-decoration: none; font-size: 0.9rem; font-weight: bold;
        }

        /* --- כרטיסי טיפול --- */
        .treatment-card {
            background: #fff; border-radius: var(--radius); padding: 15px; margin: 15px;
            box-shadow: var(--shadow); display: flex; justify-content: space-between; align-items: center;
            border-right: 3px solid var(--primary);
        }
        .add-btn {
            background: #f7f7f7; width: 40px; height: 40px; border-radius: 50%;
            border: none; color: var(--primary); font-size: 1.4rem; font-weight: bold;
        }

        /* --- דירוג כוכבים --- */
        .star-rating {
            direction: ltr; display: flex; justify-content: center; gap: 10px; font-size: 2rem; margin: 20px 0;
        }
        .star-rating i { color: #ddd; cursor: pointer; transition: color 0.2s; }
        .star-rating i.active { color: #FFD700; }

        /* --- ניווט תחתון --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: #fff;
            display: flex; justify-content: space-around; padding: 10px 0 15px;
            border-radius: 20px 20px 0 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.05); z-index: 200;
        }
        .nav-item { text-align: center; color: #bbb; font-size: 0.7rem; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { display: block; font-size: 1.3rem; margin-bottom: 4px; }

        /* --- תצוגות --- */
        .view { display: none; animation: fadeIn 0.3s; padding-bottom: 20px; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- מסך התקנה חוסם (אגרסיבי) --- */
        #install-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000;
            display: none; /* מופעל ב-JS */
            flex-direction: column; align-items: center; justify-content: center;
            color: white; text-align: center; padding: 30px;
        }
        .install-content img { width: 80px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .install-content h2 { margin: 0 0 10px; color: var(--primary); }
        .install-content p { font-size: 1.1rem; line-height: 1.5; margin-bottom: 30px; color: #eee; }
        
        /* הוראות ספציפיות */
        .ios-instructions { display: none; background: #333; padding: 15px; border-radius: 10px; margin-top: 20px; }
        .ios-step { display: flex; align-items: center; gap: 10px; margin: 10px 0; font-size: 0.9rem; text-align: right; }
        .ios-icon { font-size: 1.4rem; color: #4285F4; }
        
        .android-btn { background: white; color: black; font-weight: bold; padding: 15px 40px; border-radius: 30px; font-size: 1.2rem; border: none; margin-top: 20px; cursor: pointer; }

        .close-install { margin-top: 40px; font-size: 0.9rem; color: #777; text-decoration: underline; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <h1>SHIRA COSMETICS</h1>
        <div style="font-size: 0.8rem; color: #777;">ששת הימים 39א, הוד השרון</div>
    </header>

    <!-- VIEW: HOME -->
    <div id="view-home" class="view active">
        <div class="carousel-container">
            <div class="carousel-slide active" style="background-image: url('pic/WhatsApp Image 2025-11-22 at 3.19.56 PM.jpeg');"></div>
            <div class="carousel-slide" style="background-image: url('pic/WhatsApp Image 2025-11-22 at 3.19.55 PM.jpeg');"></div>
            <div class="carousel-slide" style="background-image: url('pic/WhatsApp Image 2025-11-22 at 3.19.54 PM.jpeg');"></div>
            <div class="hero-overlay">
                <a href="#" onclick="switchView('booking')" class="hero-btn">קבעי תור עכשיו</a>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 15px;">
            <div onclick="window.open('tel:+972538268067')" style="background:#fff; padding:15px; border-radius:12px; text-align:center; font-size:0.8rem; box-shadow:var(--shadow);">
                <i class="fas fa-phone" style="font-size:1.5rem; color:var(--primary); margin-bottom:5px;"></i><br>חיוג
            </div>
            <div onclick="window.open('https://waze.com/ul?q=Shehet+HaYamim+39a+Hod+Hasharon')" style="background:#fff; padding:15px; border-radius:12px; text-align:center; font-size:0.8rem; box-shadow:var(--shadow);">
                <i class="fas fa-location-arrow" style="font-size:1.5rem; color:var(--primary); margin-bottom:5px;"></i><br>Waze
            </div>
            <div onclick="window.open('https://wa.me/972538268067')" style="background:#fff; padding:15px; border-radius:12px; text-align:center; font-size:0.8rem; box-shadow:var(--shadow);">
                <i class="fab fa-whatsapp" style="font-size:1.5rem; color:var(--primary); margin-bottom:5px;"></i><br>הודעה
            </div>
        </div>

        <div style="padding: 20px 15px 10px; font-weight: bold; font-size: 1.2rem;">טיפולים פופולריים</div>
        <div id="catalog-preview"></div> <!-- Filled by JS -->
    </div>

    <!-- VIEW: BOOKING -->
    <div id="view-booking" class="view">
        <div style="padding: 20px;">
            <h2>הזמנת טיפול חדש</h2>
            <div id="full-catalog"></div>
            
            <div style="background: #fff; padding: 20px; border-radius: 15px; margin-top: 20px; box-shadow: var(--shadow);">
                <h3>סיכום ובחירת מועד</h3>
                <div id="cart-display" style="color: #888; margin-bottom: 15px;">הסל ריק כרגע</div>
                
                <label>תאריך ושעה:</label>
                <input type="datetime-local" id="booking-date">
                
                <label>שם מלא:</label>
                <input type="text" id="booking-name" placeholder="הקלידי את שמך">

                <button class="btn-main btn-whatsapp" onclick="sendBooking()">
                    <i class="fab fa-whatsapp"></i> שלחי לאישור בווצאף
                </button>

                <button id="btn-add-calendar" class="btn-main btn-calendar" onclick="addToGoogleCalendar()">
                    <i class="fas fa-calendar-plus"></i> שמרי ביומן שלך
                </button>
            </div>
        </div>
    </div>

    <!-- VIEW: GALLERY -->
    <div id="view-gallery" class="view">
        <div style="padding: 20px;"><h2>תיק עבודות</h2></div>
        <div id="gallery-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 15px;"></div>
    </div>

    <!-- VIEW: RATE US -->
    <div id="view-rate" class="view">
        <div style="padding: 20px;">
            <h2>דרגי את החוויה שלך</h2>
            <p style="color:#777;">דעתך חשובה לי! אשמח לשמוע איך היה הטיפול.</p>
            
            <div style="background: #fff; padding: 30px; border-radius: 20px; text-align: center; box-shadow: var(--shadow); margin-top: 20px;">
                <div class="star-rating" id="star-rating">
                    <i class="fas fa-star" data-val="1" onclick="setRating(1)"></i>
                    <i class="fas fa-star" data-val="2" onclick="setRating(2)"></i>
                    <i class="fas fa-star" data-val="3" onclick="setRating(3)"></i>
                    <i class="fas fa-star" data-val="4" onclick="setRating(4)"></i>
                    <i class="fas fa-star" data-val="5" onclick="setRating(5)"></i>
                </div>
                
                <input type="text" id="review-name" placeholder="השם שלך">
                <textarea id="review-text" rows="4" placeholder="כתבי פה את הביקורת שלך..."></textarea>
                
                <button class="btn-main" onclick="sendReview()">
                    <i class="fab fa-whatsapp"></i> שלחי ביקורת לשירה
                </button>
                <p style="font-size: 0.8rem; color: #aaa; margin-top: 10px;">הביקורת תשלח כהודעה בווצאף</p>
            </div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchView('home'); highlightNav(this)">
            <i class="fas fa-home"></i>
            <span>ראשי</span>
        </div>
        <div class="nav-item" onclick="switchView('booking'); highlightNav(this)">
            <i class="fas fa-calendar-check"></i>
            <span>תורים</span>
        </div>
        <div class="nav-item" onclick="switchView('gallery'); highlightNav(this)">
            <i class="fas fa-images"></i>
            <span>גלריה</span>
        </div>
        <div class="nav-item" onclick="switchView('rate'); highlightNav(this)">
            <i class="fas fa-heart"></i>
            <span>דרגי</span>
        </div>
    </nav>

    <!-- Install Overlay (The "Forced" Part) -->
    <div id="install-overlay">
        <div class="install-content">
            <img src="pic/icon-192.png" alt="Logo">
            <h2>התקנת האפליקציה</h2>
            <p>כדי לקבוע תורים ולהנות מהטבות, יש להתקין את האפליקציה למכשיר.</p>
            
            <!-- Android Button -->
            <button id="android-install-btn" class="android-btn" style="display:none;" onclick="triggerAndroidInstall()">
                התקנה <i class="fas fa-download"></i>
            </button>

            <!-- iOS Instructions -->
            <div id="ios-instructions" class="ios-instructions">
                <div class="ios-step">
                    <i class="fas fa-share-square ios-icon"></i>
                    <span>1. לחצי על כפתור <b>השיתוף</b> למטה בדפדפן</span>
                </div>
                <div class="ios-step">
                    <i class="fas fa-plus-square ios-icon"></i>
                    <span>2. גללי ובחרי <b>"הוסף למסך הבית"</b></span>
                </div>
                <div class="ios-step">
                    <span>3. לחצי על <b>"הוסף"</b> בפינה למעלה</span>
                </div>
            </div>

            <div class="close-install" onclick="closeInstallOverlay()">אני רק רוצה להציץ...</div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const PHONE = "972538268067";
        const treatments = [
            { id: 1, name: "לק ג'ל", price: 140 },
            { id: 2, name: "בניית ציפורניים", price: 300 },
            { id: 3, name: "עיצוב גבות", price: 70 },
            { id: 4, name: "מיקרובליידינג", price: 1100 },
            { id: 5, name: "הרמת ריסים", price: 250 }
        ];
        const galleryImages = [
            "pic/WhatsApp Image 2025-11-22 at 3.19.56 PM.jpeg",
            "pic/WhatsApp Image 2025-11-22 at 3.19.55 PM.jpeg",
            "pic/WhatsApp Image 2025-11-22 at 3.19.54 PM.jpeg",
            "pic/WhatsApp Image 2025-11-22 at 3.19.53 PM.jpeg"
        ];

        let cart = [];
        let currentRating = 0;
        let deferredPrompt; // For Android Install

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderTreatments();
            renderGallery();
            startSlider();
            checkInstallationStatus();
        });

        // --- INSTALLATION LOGIC (THE MAGIC) ---
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show Android button if event captured
            const overlay = document.getElementById('install-overlay');
            const androidBtn = document.getElementById('android-install-btn');
            if (overlay.style.display === 'flex') {
                androidBtn.style.display = 'block';
            }
        });

        function checkInstallationStatus() {
            // If running in standalone (app mode), do nothing
            if (window.matchMedia('(display-mode: standalone)').matches) {
                return; 
            }
            
            // If dismissed previously in this session, do nothing (optional)
            if (sessionStorage.getItem('installDismissed')) return;

            const overlay = document.getElementById('install-overlay');
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            
            overlay.style.display = 'flex';

            if (isIOS) {
                document.getElementById('ios-instructions').style.display = 'block';
            } else {
                // For Android, we wait for the event, but show button anyway (fallback)
                document.getElementById('android-install-btn').style.display = 'block';
            }
        }

        function triggerAndroidInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        closeInstallOverlay();
                    }
                    deferredPrompt = null;
                });
            } else {
                alert('לחצי על תפריט הדפדפן (3 נקודות) למעלה ובחרי "התקן אפליקציה"');
            }
        }

        function closeInstallOverlay() {
            document.getElementById('install-overlay').style.display = 'none';
            sessionStorage.setItem('installDismissed', 'true');
        }


        // --- APP LOGIC ---
        function startSlider() {
            let slides = document.querySelectorAll('.carousel-slide');
            let i = 0;
            setInterval(() => {
                slides[i].classList.remove('active');
                i = (i + 1) % slides.length;
                slides[i].classList.add('active');
            }, 3000);
        }

        function renderTreatments() {
            const html = treatments.map(t => `
                <div class="treatment-card">
                    <div>
                        <div style="font-weight:bold;">${t.name}</div>
                        <div style="color:var(--primary);">₪${t.price}</div>
                    </div>
                    <button class="add-btn" onclick="addToCart(${t.id})">+</button>
                </div>
            `).join('');
            document.getElementById('catalog-preview').innerHTML = html;
            document.getElementById('full-catalog').innerHTML = html;
        }

        function renderGallery() {
            document.getElementById('gallery-grid').innerHTML = galleryImages.map(src => 
                `<img src="${src}" style="width:100%; height:150px; object-fit:cover; border-radius:10px;">`
            ).join('');
        }

        function addToCart(id) {
            const item = treatments.find(t => t.id === id);
            if(item) {
                cart.push(item);
                updateCartUI();
                switchView('booking');
            }
        }

        function updateCartUI() {
            if(cart.length === 0) return;
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('cart-display').innerHTML = `
                <b>הטיפולים שנבחרו:</b><br>
                ${cart.map(i => `- ${i.name}`).join('<br>')}
                <br><br><b>סה"כ: ₪${total}</b>
            `;
        }

        function sendBooking() {
            const name = document.getElementById('booking-name').value;
            const dateVal = document.getElementById('booking-date').value;
            
            if(!name || !dateVal || cart.length === 0) {
                alert('נא למלא שם, תאריך ולבחור טיפול אחד לפחות ❤️');
                return;
            }

            const dateObj = new Date(dateVal);
            const formattedDate = dateObj.toLocaleDateString('he-IL') + ' בשעה ' + dateObj.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});

            let msg = `היי שירה! כאן ${name}.\nאשמח לקבוע תור לתאריך ${formattedDate}.\n\nהטיפולים:\n`;
            cart.forEach(i => msg += `- ${i.name}\n`);
            
            window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
            document.getElementById('btn-add-calendar').style.display = 'flex';
        }

        function addToGoogleCalendar() {
            const dateVal = document.getElementById('booking-date').value;
            if (!dateVal) return;

            const startDate = new Date(dateVal);
            const endDate = new Date(startDate.getTime() + 60*60*1000); 
            const formatGoogleDate = (date) => date.toISOString().replace(/-|:|\.\d\d\d/g, "");
            const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=טיפול אצל שירה קוסמטיקס&dates=${formatGoogleDate(startDate)}/${formatGoogleDate(endDate)}&details=טיפול מפנק אצל שירה!&location=ששת הימים 39א הוד השרון`;
            window.open(url, '_blank');
        }

        function setRating(n) {
            currentRating = n;
            document.querySelectorAll('.star-rating i').forEach(star => {
                const val = parseInt(star.getAttribute('data-val'));
                if (val <= n) star.classList.add('active');
                else star.classList.remove('active');
            });
        }

        function sendReview() {
            const name = document.getElementById('review-name').value;
            const text = document.getElementById('review-text').value;
            
            if (!currentRating || !name) {
                alert('אנא דרגי ורשמי את שמך ⭐');
                return;
            }
            const stars = '⭐'.repeat(currentRating);
            let msg = `היי שירה! רציתי לפרגן לך ❤️\nדירוג: ${stars}\n\n"${text}"\n\nמאת: ${name}`;
            window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            window.scrollTo(0,0);
        }

        function highlightNav(elem) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            elem.classList.add('active');
        }
    </script>
</body>
</html>
